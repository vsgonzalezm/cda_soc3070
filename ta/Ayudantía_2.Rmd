---
title: "Ayudant√≠a 2"
subtitle: "An√°lisis de Datos Categ√≥ricos"
author: "Roberto Vel√°zquez"
institute: üíª üìä üé®üéªüé∑ 
date: "02-09-2020"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["default","default-fonts","gentle-r.css"]
    df_print: default
    nature:
      ratio: 16:9
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: true
      slideNumberFormat: "%current%"
editor_options: 
  chunk_output_type: console
---

# Contenidos

.pull-left[

**A.-** Funciones en `R`

- <font color="#FF0066"><i>function</i></font>

**B.-** Distribuci√≥n Binomial

- <font color="#FF0066"><i>rbinom</i></font>
- <font color="#FF0066"><i>dbinom</i></font>

**C.-** Likelihood y Log-Likelihood Functions

- <font color="#FF0066"><i>function</i></font>

**D.-** Tablas de Contingencia
- <font color="#FF0066"><i>load("nsca2018.Rda")</i></font>
- <font color="#FF0066"><i>library(dyply) %>%</i></font>

**E.-** Gr√°ficos en `R`

- <font color="#FF0066"><i>ggplot2</i></font>

]

.pull-right[
**Nota**: el repositorio o library <font color="#FF0066"><i>"tidyverse"</i></font>, creado por Hadley Wickham, contiene 8 repositorios o libraries que estaremos utilizando constantemente a lo largo del curso (<font color="#FF0066"><i>ggplot2, dplyr, tidyr, readr, purrr, tibble, stringr, forcats</i></font>). 

![mc](tdye.png)

]

---

# A.- Funciones en `R`


Si bien la instalaci√≥n de `R` base incorpora las funciones necesarias para la estimaci√≥n estad√≠stica y modelamiento de nuestros datos, en ocaciones es com√∫n que necesitemos realizar tareas para las cuales el lenguaje no ha especificado una funci√≥n. Adicionalmente, al ser `R` un lenguaje de programaci√≥n, podemos optimizar rutas o caminos de estimaci√≥n creando nuestras propias funciones.


- ¬øCu√°les son los componentes de una funci√≥n?

```{r echo=TRUE, comment='#'}
# Sintaxis
area_trian <- function(base, altura) {(base * altura)/2}
cuad_bin <- function(a, b) {(a^(2)) + (2*a*b) + (b^(2))}
```
--
Donde los componentes:

**'area_trian'** = nombre asignado a la funci√≥n que ser√° ejecutado para llamarla.

**function** = comando que define argumentos y operaciones de la funci√≥n.

**()** = argumentos de la funci√≥n.

**{}** = operaciones de la funci√≥n
---
# A.- Funciones en `R`
![](magnolia.png)
---
# A.- Funciones en `R`

- Ejercicio:

El valor de salida de una obra de arte subastada por la casa de coleccionistas Sotheby's es una funci√≥n de los a√±os de antig√ºedad de la obra, donde cada a√±o cumplido agrega un plusvalor de 6000 $USD, siendo este total multiplicado por el n√∫mero de exhibiciones internacionales en las que haya sido expuesta. Con todo, debido a la alta exclusividad de estas mercanc√≠as de *distinci√≥n*, el valor de salida es ponderado por el n√∫mero de due√±os previos de la obra.

--

**a.-** Defina una funci√≥n que permita saber el valor de salida de las obras si la subasta fuera este a√±o.

**b.-** ¬øCu√°l ser√≠a el valor de salida de la obra "Magnolias" de Frida Kahlo (1945), la cual ha participado de 15 exhibiciones internacionales y ha tenido solo 2 due√±os a la fecha?

--
```{r echo=TRUE, comment='#'}
# Sintaxis
#a
valor_subasta <- function(year, intex, owners) {(((2020-year)*6000)*intex)/owners}
#b
magnolia <- valor_subasta(year=1945, intex=15, owners=2)
magnolia
```
---
# B.- Distribuci√≥n Binomial

La simulaci√≥n de variables aleatorias que sigan par√°metros de distribuci√≥n Bernoulli y Binomial puede ser ejecutadas a trav√©s de dos funciones incorporadas en `R` base.

--

**rbinom**: Esta funci√≥n genera un vector de variables aleatorias distribuidas binomialmente.

```{r echo=TRUE, comment='#'}
# Sintaxis
coin1 <- rbinom(n=1, size=1, p=0.5)
coin1
```

--

Donde los argumentos:

**n** = n√∫mero de experimentos independientes.

**size** = n√∫mero de intentos o teraciones.

**p** = probabilidad de √©xito.

---

# B.- Distribuci√≥n Binomial

Ejemplo:

1) Lanzar una moneda con probabilidad $p=0.1$ de obtener 'Cara' (√©xito).

```{r echo=TRUE, comment='#'}
# Sintaxis
ej1 <- rbinom(n=20, size=1, p=0.1)
ej1
```

--

2) Lanzar cien veces una moneda con probabilidad $p=0.4$ de obtener 'Cara' (√©xito).


```{r echo=TRUE, comment='#'}
# Sintaxis
ej2 <- rbinom(n=100, size=1, p=0.4)
ej2
```

---

# B.- Distribuci√≥n Binomial

**dbinom**: Esta funci√≥n devuelve el valor de la funci√≥n de densidad de probabilidad (pdf) de la distribuci√≥n binomial.

--

```{r echo=TRUE, comment='#'}
# Sintaxis
coin2 <- dbinom(x=2,size=10,prob=0.3)
coin2
```

--

Donde los argumentos:

**x** = n√∫mero de √©xitos.

**size** = n√∫mero de intentos o teraciones.

**p** = probabilidad de √©xito.

---

# B.- Distribuci√≥n Binomial

Ejemplo:

3) Si la probabilidad de obtener "Cara" es de 70% (*p*=0.7), ¬øcu√°l es la probabilidad de obtener 7 √©xitos en 30 lanzamientos?

$$\mathbb{P}(Y=7) = \frac{30!}{7!23!} \times (0.7)^{7} \times (1-0.7)^{23}= ?$$
--

```{r echo=TRUE, comment='#'}
# Sintaxis
ej3 <- dbinom(x=7,size=30,prob=0.7)
ej3
```

--

4) ¬ø Y la probabilidad de obtener 21 √©xitos en 30 lanzamientos?

--

```{r echo=TRUE, comment='#'}
# Sintaxis
ej4 <- dbinom(x=21,size=30,prob=0.7)
ej4
```

---
# C.- Likelihood y Log-Likelihood Functions

- **Likelihood Function**: Funci√≥n que cuantifica la plausibilidad de diferentes valores del par√°metro dados los datos.

 $\mathcal{L}(p) = P(X_{1})P(X_{2}) \dots P(X_{n}) = \frac{n!}{k! (n-k)!}*p^{k}(1-p)^{n-k} \quad \text{   donde  } k= \sum X_{i}$

--

- **Log-Likelihood Function**: Maximizaci√≥n de la likelihood function en base a las propiedades del logaritmo natural.

 $\ell\ell(p) = \ln \mathcal{L}(p)  = \ln\frac{n!}{k! (n-k)!}+ k \ln(p) + (n - k) \ln(1-p)$ 

--

- As√≠, el **Maximum Likelihood Estimation** de $p$ es la proporci√≥n de 1's en la muestra.

 $\hat{p} = \frac{\sum X_{i}}{n}$
 
 De acuerdo a lo visto anteriormente...

---
# C.- Likelihood y Log-Likelihood Functions
![](orq.png)
---
# C.- Likelihood y Log-Likelihood Functions

- Ejercicio:

Con el prop√≥sito de saber qu√© parte de los m√∫sicos cl√°sicos m√°s renombrados de EEUU deben el √©xito en sus carreras al talento musical 'innato', y no a su capital econ√≥mico, social y cultural, un soci√≥logo entrevista a 100 m√∫sicos de las orquestas filarm√≥nicas m√°s importantes del pa√≠s para registrar qui√©nes tienen 'oido absoluto' asumiendo iid.  Posteriormente grafica los resultado de los y las entrevistados en su muestra. Como el investigador no cuenta con el par√°metro poblacional, les pide ayuda para estimar qu√© valor *p* es m√°s plausible que genere sus datos. 

```{r echo=FALSE, fig.height=4, fig.width=5, message=FALSE, warning=FALSE}
library(tidyverse)
library(wesanderson)

set.seed(1234)
data_musiques <- data.frame(X = rbinom(n=100, size=1, prob=0.01))

data_musiques %>% ggplot(aes(x=factor(X), fill="")) + 
    geom_bar(fill=wes_palette("Darjeeling1",n=2)[2]) +
    geom_text(aes(label=..count..), stat='count', vjust=-0.2) +
    guides(fill=FALSE, color=FALSE) + labs(x="O√≠do absoluto No (0), S√≠ (1)", y="Conteo") +
    theme(axis.text.y = element_text(size = 12), axis.text.x = element_text(size = 12),
    axis.title.y = element_text(size = 12), axis.title.x = element_text(size = 12))
```

---
# C.- Likelihood y Log-Likelihood Functions

- Ejercicio:

**a.-** Defina las funciones Likelihood y Log-likelihood en base al tipo de distribuci√≥n que asumimos.

--

```{r echo=TRUE, comment='#'}
# Sintaxis
#a.Likelihood y Log-likelihood functions para una distribuci√≥n binomial
L <- function(p, n, k){choose(n,k)*(p^(k))*((1-p)^(n-k))}
LL <- function(p,n,k) {log(choose(n,k))+(k * log(p)) + ((n - k)*log(1-p))}
```
--

**b.-** ¬øCu√°l es el valor $p$ m√°s plausible de los datos del investigador de acuerdo a la Likelihood function? 
  
```{r echo=TRUE, fig.height=4, fig.width=5, message=FALSE, warning=FALSE}
# Sintaxis
#b.Estimaci√≥n v√≠a MLE y funci√≥n de SE
p1 <- L(p=0.01,n=100,k=1)
p1
```
---
# C.- Likelihood y Log-Likelihood Functions

- Ejercicio:

```{r echo=TRUE, fig.height=4, fig.width=5, message=FALSE, warning=FALSE}
#Sintaxis
#b.Gr√°ficamente
data_musiques2 <- data_frame(x = seq(from = 0, to = 1, by=0.01), y = (100*(x^(1))*((1-x)^(99)) ))
plot <- ggplot(data = data_musiques2, mapping = aes(x = x)) +
geom_path(aes(y=y), size=1.5, colour="#00A08A") +
labs(y="L(p)", x="p", title="Likelihood Function de p")
print(plot)
```
---
# C.- Likelihood y Log-Likelihood Functions

- Ejercicio:

**c.-** ¬øCu√°l ser√≠a el log-likelihood de m√∫sicos y m√∫sicas con 'o√≠do absoluto' en las orquestas filarm√≥nicas m√°s importantes de EEUU para una probabilidad de 60% y 80% ? Eval√∫e.

--

```{r echo=TRUE, comment='#'}
# Sintaxis
#c.Evaluaci√≥n 
p60 <- LL(p=0.6,n=100,k=1) 
p80 <- LL(p=0.8,n=100,k=1)
p60
p80
```

<font color="#FF0066"><i>Bonus</i></font>: ¬øQu√© debo hacer para conocer el valor probabil√≠sticos de estos resultados?
---
# C.- Likelihood y Log-Likelihood Functions

- Ejercicio:

**d.-** Volviendo a los datos del investigador ¬øCu√°l ser√≠a el error estandar y los intervalos de confianza para un $\alpha=0.05$ a partir de la muestra? 

--
```{r echo=TRUE, comment='#'}
# Sintaxis
#d. Standard Error 
se <- function(n,p){sqrt((p*(1-p))/n)}
se_musiques <- se(100, 0.01)
se_musiques 

#d. Confidence Intervals
p_hat <- 0.01
ci_sup <- p_hat + 1.96 * se_musiques
ci_inf <- p_hat - 1.96 * se_musiques
```
---
# C.- Likelihood y Log-Likelihood Functions

- Ejercicio:

**d.-** Volviendo a los datos del investigador ¬øCu√°l ser√≠a el error estandar y los intervalos de confianza para un $\alpha=0.05$ a partir de la muestra? 

--
```{r echo=TRUE, comment='#'}
# Sintaxis
#d. Confidence Intervals
ci_sup 
ci_inf
```

El porcentaje de m√∫sicos cl√°sicos renombrados con 'o√≠do absoluto' parece estar entre 0% de quienes se encuentran en las orquestas m√°s renombradas de EEUU, pero no superan el 3% entre estos profesionales.

---
# D.- Tablas de Contingencia

![](nefa.png)

---
# D.- Tablas de Contingencia

En esta secci√≥n trabajaremos sobre los datos de la **National Survey of Culture and the Arts 2018** coordinada por el *National Endowment for the Arts USA* con un muestreo representativo de la poblaci√≥n de EEUU. La muestra contiene 8609 casos y variables demogr√°ficas, socioecon√≥micas y de consumo cultural. En esta ocaci√≥n trabajaremos con 10 de ellas.

```{r echo=TRUE, comment='#'}
# Sintaxis
#Cargar base de datos
load("nsca2018.Rda")
```

---

# D.- Tablas de Contingencia

En esta secci√≥n trabajaremos sobre los datos de la **National Survey of Culture and the Arts 2018** coordinada por el *National Endowment for the Arts USA* con un muestreo representativo de la poblaci√≥n de EEUU. La muestra contiene 8609 casos y variables demogr√°ficas, socioecon√≥micas y de consumo cultural. En esta ocaci√≥n trabajaremos con 10 de ellas.

```{r echo=TRUE, comment='#'}
# Sintaxis
#Exploraci√≥n de datos
tibble(data1)
```

---
# D.- Tablas de Contingencia

Justamente, una de las discusiones m√°s recientes en los estudios interseccionales de las relaciones entre g√©nero y preferencias culurales se ha centrado en comprender las distribuciones de datos entre formas est√©ticas y tipo de afluencias de p√∫blicos. En este contexto, parece interesante explorar los registros de p√∫blicos en estados unidos en funci√≥n del g√©nero de los asistentes a 6 clases de eventos  del calendario anual de ofertas culturalesv(conciertos de jazz, m√∫sica cl√°sica, opera, ballet, exposiciones de arte contempor√°neo en museos, y compras de libros).


```{r echo=TRUE, comment='#'}
# Sintaxis
#Relaciones multivariadas (en este caso bivariadas)
ctable1 <- data1 %>% with(table(sexo,jazz))
print(ctable1)
```
---
# D.- Tablas de Contingencia

```{r echo=TRUE, comment='#'}
# Sintaxis
#Relaciones multivariadas (en este caso bivariadas)
ctable2 <- data1 %>% with(table(sexo,ballet))
print(ctable2)

ctable3 <- data1 %>% with(table(sexo,museos))
print(ctable3)
```
---
# D.- Tablas de Contingencia

```{r echo=TRUE, comment='#'}
# Sintaxis
#Relaciones multivariadas 
ctable4 <- data1 %>% with(table(raza,jazz))
print(ctable4)
```
---
# D.- Tablas de Contingencia

- Ejercicio:

![](jazz.png)
---
# D.- Tablas de Contingencia

- Ejercicio:

Una de las discusiones m√°s interesantes en la configuraci√≥n de los mundos de arte musical en la cultura popular estadounidense, recientemente ha girado  en torno a la inversi√≥n simultanea entre *performers* y *p√∫blicos* en base a la composici√≥n de g√©nero de √©stos. Dicha particularidad, observan investigadores en sociolog√≠a de la m√∫sica, resulta ser particularmente acentuada en la constituci√≥n de la m√∫sica jazz. A diferencia de los a√±os 1930s y 1940s, en que las mujeres eran las grandes protagonistas de los escenarios y los hombres eran el principal p√∫blico, en la actualidad esta relaci√≥n se habr√≠a invertido, dando como resultado el escazo protagonismo femenino en los escenarios, generando un desplazamiento de √©stas hacia p√∫blicos. Se cree que hoy el principal p√∫blico que asiste a eventos de m√∫sica jazz, son mujeres.

Exploremos inicialmente esta relaci√≥n en base a los p√∫blicos de jazz en el 2018 con **n=8609**:

**a.-** De acuerdo a la relaci√≥n bivariada jazz|sexo, en 2018 ¬øcu√°l era la probabilidad de haber encontrado una **mujer que haya asistido a eventos de jazz** y la probabilidad de haber encontrado un **hombre que haya asitido**?

**b.-** ¬øCu√°l era la probabilidad de haber sido un **hombre** y, de forma independiente, la probabilidad de haber sido alguien que **no asisti√≥ a eventos de jazz** en 2018?

**c.-** ¬øCu√°l era la probabilidad de que, **siendo una mujer estadounidense**, no **hayas asistido a un evento de jazz** en 2018?

---
# D.- Tablas de Contingencia

**a.-** De acuerdo a la relaci√≥n bivariada jazz|sexo, en 2018 ¬øcu√°l era la probabilidad de haber encontrado una **mujer que haya asistido a eventos de jazz** y la probabilidad de haber encontrado un **hombre que haya asitido**?

--

```{r echo=TRUE, comment='#'}
# Sintaxis
#Relaciones multivariadas (en este caso bivariadas)
ctable1 <- data1 %>% with(table(sexo,jazz))
print(ctable1)

# Distribuci√≥n conjunta
joint_dis <- ctable1/sum(ctable1); joint_dis 
```
---
# D.- Tablas de Contingencia

**b.-** ¬øCu√°l era la probabilidad de haber sido un **hombre** y, de forma independiente, la probabilidad de haber sido alguien que **no asisti√≥ a eventos de jazz** en 2018?

--

```{r echo=TRUE, comment='#'}
#Sintaxis
#Distribuci√≥n marginal de sexo 
margin_sexo <- apply(joint_dis,1,sum); margin_sexo 

#Distribuci√≥n marginal de jazz 
margin_jazz <- apply(joint_dis,2,sum); margin_jazz

```
---
# D.- Tablas de Contingencia

**c.-** ¬øCu√°l era la probabilidad de que, **siendo una mujer estadounidense**, no **hayas asistido a un evento de jazz** en 2018?

--

```{r echo=TRUE, comment='#'}
#Sintaxis
#Distribucuiones condicionales
ctable1 <- data1 %>% with(table(sexo,jazz)) # relacion bivariada como tabla de contingencia
joint_sexo_jazz <- ctable1/sum(ctable1) #distribuci√≥n conjunta de las variables
margin_sexo <- apply(joint_sexo_jazz,1,sum) # distribuci√≥n marginal de sexo
joint_sexo_jazz/margin_sexo #distribuci√≥n condicional de jazz dado sexo 
```

---
# D.- Tablas de Contingencia


<font color="#FF0066"><i>Bonus</i></font>: ¬øCu√°les ser√≠an las **probabilidades esperadas** si asumieramos que sexo y la asistencia a eventos de m√∫sica jazz son variables totalmente independientes entre s√≠?

--

**Distribuciones marginales**
```{r echo=FALSE}
#marginal sexo 
margin_sexo <- apply(joint_dis,1,sum); margin_sexo 
#marginal jazz 
margin_jazz <- apply(joint_dis,2,sum); margin_jazz
```

--

**Probabilidad esperada bajo** $X \perp Y$

```{r}
#Distribuci√≥n 
joint_sexo_jazz_ind <- margin_sexo %*% t(margin_jazz)
print(joint_sexo_jazz_ind)
```
---
# D.- Tablas de Contingencia


<font color="#FF0066"><i>Bonus</i></font>: ¬øY las **frecuencias esperadas**?

--

```{r}
#Frecuencias esperadas bajo independencia
joint_sexo_jazz_freq <- joint_sexo_jazz_ind*8609 
print(joint_sexo_jazz_freq)
```

---
# E.- Gr√°ficos en `R`

Una de las herramientas m√°s √∫tiles para la exploraci√≥n y evaluaci√≥n de nuestros datos son los an√°lisis visuales disponibles a partir de distintas funciones de `R`. Con todo, uno de los repositorios m√°s √∫tiles y de m√°s alta potencia gr√°fica es  **library(ggplot2)** el cual forma parte de las funciones incluidas en la librer√≠a **library(tidyverse)**. 

A continuaci√≥n veamos una breve introducci√≥n a su sintaxis y usos.

![](ggplot2.png)

---
# E.- Gr√°ficos en `R`

- Existen 3 elementos centrales en la sintaxis del comando *ggplot*:

**1** - Una estructura visual (aesthetic) que le informa a  *ggplot* qu√© variables ser√°n mapeadas en el eje *X* e *Y*, (y frecuentemente otros atributos del gr√°fico, como los esquemas de color con que ser√°n completados). Intuitivamente, <font color="#009999"><i>`aes`</i></font> puede ser pensada como la funci√≥n que especifica qu√© estar√°s graficando.

**2** - Una geometr√≠a (geom) que le informa a *ggplot* cu√°l ser√° la estructura b√°sica para la creaci√≥n del gr√°fico. Intuitivamente, <font color="#009999"><i>`geom`</i></font> puede ser pensada como la funci√≥n que especifica c√≥mo estar√°s graficando.

**3** - Otras opciones de customizaci√≥n (labels), como los t√≠tulos del gr√°fico, los tama√±os de los elementos, el tipo de tema de construcci√≥n, etc. En la funci√≥n esto es conocido como <font color="#009999"><i>`labs`</i></font>.

Entonces:

- $ggplot=aes+geom+labs$

- $ggplot=(df,x=, y=) + (type, fill) + (title, subtitle, caption)$

Veamos ejemplos concretos usando la NSCA.

---
# E.- Gr√°ficos en `R`

- Exploremos el tipo de gr√°ficos en base a la distribuci√≥n del n de hijes de las personas en la muestra:

<font color="#009999"><i>Histograma</i></font>:

```{r echo=TRUE, fig.height=3.5, fig.width=4.5, message=FALSE, warning=FALSE}
#Sintaxis
#Histograma de n√∫mero de hijes
ggplot(data1, aes(x = hijes)) + 
  geom_histogram(fill=wes_palette("Darjeeling1",n=2)[2]) + 
  labs(title = "NSCA 2018", subtitle = "Histograma de Hijes", 
       caption = "Figura 1", x = "hijes", y = "conteo")
```
---
# E.- Gr√°ficos en `R`

- Exploremos el tipo de gr√°ficos en base a la distribuci√≥n del n de hijes de las personas en la muestra:

<font color="#009999"><i>Densidad</i></font>:

```{r echo=TRUE, fig.height=3.5, fig.width=4.5, message=FALSE, warning=FALSE}
#Sintaxis
#Densidad de n√∫mero de hijes
ggplot(data1, aes(x = hijes)) + 
  geom_density(fill=wes_palette("Darjeeling1",n=2)[2]) + 
  labs(title = "NSCA 2018", subtitle = "Histograma de Hijes", 
       caption = "Figura 2", x = "hijes", y = "densidad")
```
---
# E.- Gr√°ficos en `R`

- Exploremos ahora las distribuciones de los campos culturales:

<font color="#009999"><i>Barras</i></font>:

```{r echo=TRUE, fig.height=3.5, fig.width=4.5, message=FALSE, warning=FALSE}
#Sintaxis
#Gr√°fico de barras libros
ggplot(data1, aes(x = libros)) +
  geom_bar(fill=wes_palette("Darjeeling1",n=2)[2]) + 
  labs(title = "NSCA 2018", subtitle = "Frecuencia Libros", 
       caption = "Figura 3", x = "libros", y = "conteo")
```
---
# Referencias Sugeridas:

‚Ä¢ Laurie Hanquinet & Mike Savage (2016). Routledge International Handbook of the Sociology of Art and Culture. London: Routledge.

‚Ä¢ Hadley Wickham (2015). Advanced R, CRC Press, Taylor & Francis Group, Boca Raton, FL. En https://adv-r.hadley.nz/

‚Ä¢ Hadley Wickham and Garrett Grolemund (2017). R for Data Science. Import, Tidy, Transform, Visualize, and Model Data. O‚ÄôReilly Media, Inc.. En https://r4ds.had.co.nz/


---
class: inverse, center, middle

.huge[
**¬°Hasta la pr√≥xima!**
]

 üíª üìä üé®üéªüé∑ 
 
<br>
Roberto Vel√°zquez <br>
https://github.com/rovelazqu <br>




